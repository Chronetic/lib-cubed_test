<p id="notice"><%= notice %></p>

<h1>Shows</h1>

<% totalseasons = 0 %>
<% totalepisodes = 0 %>
<% averagerating = 0 %>
<% totalshows = 0 %>
<% totaltime = 0 %>

<table class="table is-striped is-hoverable">
  <thead>
    <tr>
			<th></th>
      <th>Title</th>
      <th>Description</th>
      <th>Seasons</th>
      <th>Episodes</th>
			<th>Rating</th>
			<th>Airdate</th>
      <th>User</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @shows.each.with_index(0) do |show, index| %>
      <tr>
				<% if show.user_id == current_user.id %>
				<td><%= "#{index}" %></td>
        <td><%= show.title %></td>
				<% totalshows+= 1 %>
        <td><%= truncate show.description, length: 45, seperator: /\w+/ %></td>
        <td><%= show.seasons %></td>
				<% totalseasons+= show.seasons %>
        <td><%= show.episodes %></td>
				<% totalepisodes+= show.episodes %>
				<% totaltime+= (totalepisodes * show.episoderuntime) %>
				<td><%= show.showrating %></td>
				<% averagerating+= show.showrating %>
				<td><%= show.airdate %></td>
        <td><%= show.user_id %></td>
        <td><%= link_to 'Show', show %></td>
        <td><%= link_to 'Edit', edit_show_path(show) %></td>
        <td><%= link_to 'Destroy', show, method: :delete, data: { confirm: 'Are you sure?' } %></td>
				<% end %>
		  </tr>
    <% end %>
  </tbody>
</table>

<table class="table is-striped is-hoverable">
	<thead>
    <tr>
			<th>Stats:</th>
			<th>Shows</th>
      <th>Seasons</th>
      <th>Episodes</th>
      <th>Average Rating</th>
			<th>Days Watched</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
		<tr>
			<td>Totals:</td>
			<td><p class="has-text-centered"><%= totalshows %></p></td>
			<td><p class="has-text-centered"><%= totalseasons %></p></td>
			<td><p class="has-text-centered"><%= totalepisodes %></p></td>
			<td><p class="has-text-centered"><%= averagerating / totalshows %></p></td>
			<td><p class="has-text-centered"><%= ((totaltime / 60.0) / 24.0).round(2) %> (<%= (totaltime / 60.0).round(2) %> hrs)</p></td>
		</tr>
  </tbody>
</table>

<br>
<%= link_to 'Back', "home" %>
<%= link_to 'New Show', new_show_path %>
